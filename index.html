<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App Example</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
</head>
<body>
    <h1>Telegram Web App Example</h1>
    <button onclick="sendDataToBot()">Send Data to Bot</button>

    <script>
        if (window.Telegram && window.Telegram.WebApp) {
            console.log('Web App otwarta w kontekście Telegram');
        } else {
            console.log('Web App nie jest otwarta w kontekście Telegram');
        }

        function sendDataToBot() {
            const data = {message: 'Hello from Web App!'};
            console.log('Próba wysłania danych:', data);
            try {
                window.Telegram.WebApp.sendData(JSON.stringify(data));
                console.log('Dane wysłane pomyślnie');
            } catch (error) {
                console.error('Błąd podczas wysyłania danych:', error);
            }
        }
    </script>

    <h1>Connect Your TON Wallet</h1>
    <button id="connectButton">Connect Wallet</button>
    <div id="walletInfo"></div>

    <script>
        if (typeof TonConnect === 'undefined') {
            console.error('TonConnect is not defined');
        } else {
            console.log('TonConnect is defined');

            const connector = new TonConnect({
                manifestUrl: 'https://sh4do96.github.io/TelegramBot/tonconnect-manifest.json'
            });

            const buttonElement = document.getElementById('connectButton');
            const walletInfoElement = document.getElementById('walletInfo');

            buttonElement.addEventListener('click', async () => {
                try {
                    const walletConnectionSource = {
                        universalLink: 'https://app.tonkeeper.com/ton-connect',
                        bridgeUrl: 'https://bridge.tonapi.io/bridge'
                    };

                    await connector.connect(walletConnectionSource);

                    updateWalletInfo();
                } catch (error) {
                    console.error('Error connecting wallet:', error);
                    walletInfoElement.textContent = 'Failed to connect wallet. Please try again.';
                }
            });

            connector.onStatusChange(async (walletInfo) => {
                if (walletInfo) {
                    updateWalletInfo();
                } else {
                    walletInfoElement.textContent = 'Wallet disconnected';
                }
            });

            async function updateWalletInfo() {
                const walletInfo = connector.account;
                if (walletInfo) {
                    walletInfoElement.textContent = `Connected wallet address: ${walletInfo.address}`;
                } else {
                    walletInfoElement.textContent = 'No wallet connected';
                }
            }
        }
    </script>
</body>
</html>